<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…ìŠ¤íŠ¸ ì •ì œê¸° - ì‰½ê²Œ ê°€ì</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* ê¸°ë³¸ ë°°ê²½: í¬ë¦¼ìƒ‰ */
            --bg-cream: #fdfbf7;
            --card-white: #ffffff;
            
            /* [í†µì¼ëœ í…Œë§ˆ ì»¬ëŸ¬] í•‘í¬ ê³„ì—´ */
            --theme-main: #ffb7b2;      /* ë©”ì¸ í•‘í¬ */
            --theme-deep: #ff8fab;      /* ì§„í•œ í•‘í¬ (ê°•ì¡°) */
            --theme-light: #fff0f0;     /* ì—°í•œ ë°°ê²½ìš© */

            /* í…ìŠ¤íŠ¸ & í…Œë‘ë¦¬ */
            --text-main: #4a4a4a;
            --text-sub: #777777; 
            --border-line: #f0ebeb; 
            --btn-gray: #f0f0f0;        /* íšŒìƒ‰ ë²„íŠ¼ ë°°ê²½ */
        }

        body {
            font-family: 'Gowun Dodum', 'Pretendard', sans-serif;
            margin: 0;
            background-color: var(--bg-cream);
            color: var(--text-main);
            padding-top: 90px;
            padding-bottom: 50px;
        }

        /* --- [ë©”ë‰´ë°”: ì°¨ë¶„í•˜ê²Œ í†µì¼] --- */
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; height: 70px;
            background: rgba(255, 255, 255, 0.98); 
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; box-sizing: border-box; z-index: 1000;
            border-bottom: 1px solid #eee;
        }
        
        .logo {
            font-size: 1.15rem; color: #555; text-decoration: none;
            display: flex; align-items: center; gap: 8px; font-weight: bold;
            letter-spacing: -0.5px;
        }
        
        .nav-links { display: flex; gap: 5px; align-items: center; }
        
        /* ë©”ë‰´ ì•„ì´í…œ: ê¸°ë³¸ì€ ì–Œì „í•œ íšŒìƒ‰ */
        .nav-item {
            text-decoration: none; color: #999; font-weight: 600; 
            padding: 8px 16px; font-size: 0.95rem;
            border-radius: 20px; display: flex; align-items: center; gap: 6px;
            transition: all 0.2s;
        }
        .nav-item:hover { color: #555; background-color: #f8f8f8; }

        /* í™œì„±í™”ëœ ë©”ë‰´ë§Œ í•‘í¬ìƒ‰ í¬ì¸íŠ¸ */
        .nav-item.active {
            background-color: var(--theme-light);
            color: var(--theme-deep);
            font-weight: 700;
        }

        /* --- [ì»¨í…Œì´ë„ˆ] --- */
        .container {
            max-width: 900px; margin: 0 auto;
            background: var(--card-white);
            padding: 40px;
            border-radius: 25px;
            border: 2px solid var(--border-line);
            box-shadow: 0 8px 20px rgba(200, 200, 200, 0.05); /* ê·¸ë¦¼ìë„ ì€ì€í•˜ê²Œ */
        }

        .header-area {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 30px; padding-bottom: 15px;
            border-bottom: 2px dashed var(--border-line);
        }
        .header-area h2 { margin: 0; color: var(--text-main); font-size: 1.8rem; letter-spacing: -1px; }
        
        /* ë‹¨ì–´ì¥ ë²„íŠ¼: íŠ€ì§€ ì•ŠëŠ” ì›œê·¸ë ˆì´ */
        .btn-dict-open {
            background-color: #f2f2f2; color: #666;
            padding: 8px 18px; border-radius: 15px; border: none; font-weight: bold;
            cursor: pointer; transition: 0.2s; font-family: 'Gowun Dodum'; font-size: 0.95rem;
            display: flex; align-items: center; gap: 6px;
        }
        .btn-dict-open:hover { background-color: #e5e5e5; color: #333; }

        /* --- [ì…ë ¥/ì¶œë ¥ ë ˆì´ë¸”] --- */
        .label-area {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; margin-top: 10px;
        }
        label { font-weight: bold; color: var(--text-main); font-size: 1.1rem; display: flex; align-items: center; gap: 5px;}
        
        .char-count { 
            font-size: 0.85rem; color: #aaa; font-weight: bold; 
            background: #f8f9fa; padding: 5px 12px; border-radius: 12px;
        }

        textarea {
            width: 100%; height: 200px;
            padding: 20px; margin-bottom: 20px;
            border: 2px solid var(--border-line); border-radius: 15px;
            font-size: 16px; line-height: 1.6; color: #555;
            box-sizing: border-box; resize: vertical;
            font-family: 'Pretendard', sans-serif;
            transition: all 0.2s; outline: none; background: #fafafa;
        }
        textarea:focus { border-color: var(--theme-main); background: #fff; }

        /* --- [ë©”ì¸ ë²„íŠ¼ ê·¸ë£¹: í•‘í¬ í†¤ì˜¨í†¤] --- */
        .btn-group { display: flex; gap: 15px; margin-bottom: 30px; justify-content: center; }
        
        .action-btn {
            flex: 1; padding: 15px; font-size: 1.05rem; cursor: pointer; border: none;
            border-radius: 15px; font-weight: bold; transition: all 0.2s;
            font-family: 'Gowun Dodum', sans-serif; color: white;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .action-btn:hover { transform: translateY(-2px); opacity: 0.9; }

        /* 1ì°¨ ì •ì œ: ì—°í•œ í•‘í¬ */
        .btn-clean { background-color: var(--theme-main); color: #fff; } 
        /* 2ì°¨ ë³€í™˜: ì§„í•œ í•‘í¬ (ê°™ì€ ê³„ì—´, ë†ë„ ì°¨ì´) */
        .btn-convert { background-color: var(--theme-deep); color: #fff; } 
        /* ì´ˆê¸°í™”: ê¹”ë”í•œ íšŒìƒ‰ */
        .btn-reset { background-color: var(--btn-gray); color: #777; width: 100px; flex: none; box-shadow: none; }
        .btn-reset:hover { background-color: #e0e0e0; }

        /* --- [ìœ í‹¸ë¦¬í‹° ë°”: ì°¨ë¶„í•œ ê·¸ë ˆì´] --- */
        .utility-bar {
            background: #f8f9fa; padding: 15px; border-radius: 15px;
            margin-bottom: 15px; display: flex; gap: 10px;
        }
        .btn-util {
            padding: 10px 20px; font-size: 0.95rem; cursor: pointer; border: none;
            border-radius: 10px; font-weight: bold; font-family: 'Pretendard';
            transition: 0.2s; display: flex; align-items: center; gap: 6px;
        }
        /* ë³µì‚¬/ì €ì¥ ë²„íŠ¼ì„ ë¬´ì±„ìƒ‰ìœ¼ë¡œ í†µì¼í•˜ì—¬ ì‹œì„  ë¶„ì‚° ë°©ì§€ */
        .btn-copy { background-color: #555; color: #fff; flex: 1; justify-content: center;}
        .btn-save { background-color: #ddd; color: #555; flex: 0.4; justify-content: center;}
        
        .btn-util:hover { transform: translateY(-2px); filter: brightness(0.95); }


        /* --- [ëª¨ë‹¬] --- */
        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: white; margin: 8% auto; padding: 30px;
            border-radius: 20px; width: 90%; max-width: 450px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #f0ebeb;
            position: relative; display: flex; flex-direction: column;
            max-height: 80vh;
        }
        .close-btn { position: absolute; top: 20px; right: 25px; font-size: 28px; cursor: pointer; color:#ccc;}
        .close-btn:hover { color: var(--theme-deep); }

        .dict-form { margin-bottom: 20px; background: var(--theme-light); padding: 20px; border-radius: 15px; }
        .dict-form input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ffdbd9; border-radius: 8px; box-sizing: border-box;}
        .btn-add { background-color: var(--theme-deep); color: white; width: 100%; padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;}

        .dict-list-container { flex-grow: 1; overflow-y: auto; border: 1px solid #eee; margin-bottom: 15px; padding: 10px; border-radius: 10px; height: 300px;}
        .dict-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f5f5f5; padding: 10px; font-size: 14px;}
        .btn-delete { background-color: #eee; color: #777; border: none; border-radius: 5px; font-size: 12px; padding: 5px 10px; cursor: pointer;}
        .btn-delete:hover { background-color: #ffdede; color: #d63384; }
        
        .backup-area { display: flex; gap: 10px; border-top: 1px solid #eee; padding-top: 20px; }
        .btn-backup { background-color: #f0f0f0; color: #555; flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 13px;}
        
        @media (max-width: 600px) {
            .navbar { padding: 0 15px; height: 60px; }
            .nav-item span { display: none; }
            .container { padding: 20px; }
            .btn-group { flex-direction: column; }
            .btn-reset { width: 100%; }
        }
    </style>
</head>
<body>

<nav class="navbar">
    <a href="index.html" class="logo">
        <span style="font-size: 1.2rem;">â˜ï¸</span> ì™œ ì¼ ì€ í•œë²ˆì— ëª°ë ¤ì˜¤ëŠ” ê±¸ê¹Œìš”? <span style="font-size: 1.2rem;">ğŸŒ¸</span>
    </a>
    
    <div class="nav-links">
        <a href="index.html" class="nav-item"><i class="fa-solid fa-house"></i><span>í™ˆ</span></a>
        <a href="cleaner.html" class="nav-item active"><i class="fa-solid fa-broom"></i><span>ì •ì œ</span></a>
        <a href="marker.html" class="nav-item"><i class="fa-solid fa-highlighter"></i><span>ìë£Œ</span></a>
        <a href="splitter.html" class="nav-item"><i class="fa-solid fa-align-left"></i><span>ë¶„í• </span></a>
    </div>
</nav>

<div class="container">
    <div class="header-area">
        <h2>ğŸ“ í…ìŠ¤íŠ¸ ì •ì œê¸°</h2>
        <button class="btn-dict-open" onclick="openModal()"><i class="fa-solid fa-book"></i> ë‹¨ì–´ì¥ ê´€ë¦¬</button>
    </div>

    <div class="label-area">
        <label for="inputText"><i class="fa-regular fa-file-lines"></i> 1. ì›ë³¸ í…ìŠ¤íŠ¸</label>
        <span class="char-count" id="inputCount">ìˆœìˆ˜ ê¸€ììˆ˜: 0ì</span>
    </div>
    <textarea id="inputText" placeholder="ì—¬ê¸°ì— ì§€ì €ë¶„í•œ ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”... (íŠ¹ìˆ˜ë¬¸ì, ì¤„ë°”ê¿ˆ ë“± í¬í•¨)" oninput="updateCount('inputText', 'inputCount')"></textarea>

    <div class="btn-group">
        <button class="action-btn btn-clean" onclick="runStage1()">
            <i class="fa-solid fa-soap"></i> 1ì°¨ ì •ì œ (íŠ¹ìˆ˜ë¬¸ì ì œê±°)
        </button>
        <button class="action-btn btn-convert" onclick="runStage2()">
            <i class="fa-solid fa-language"></i> 2ì°¨ ë³€í™˜ (í•œê¸€/ìˆ«ì)
        </button>
        <button class="action-btn btn-reset" onclick="resetAll()">
            <i class="fa-solid fa-rotate-left"></i> ì´ˆê¸°í™”
        </button>
    </div>

    <div class="label-area">
        <label for="outputText"><i class="fa-solid fa-file-signature"></i> 2. ë³€í™˜ ê²°ê³¼ë¬¼</label>
        <span class="char-count" id="outputCount">ìˆœìˆ˜ ê¸€ììˆ˜: 0ì</span>
    </div>
    
    <div class="utility-bar">
        <button class="btn-util btn-copy" onclick="copyToClipboard()"><i class="fa-regular fa-copy"></i> ê²°ê³¼ ë³µì‚¬í•˜ê¸°</button>
        <button class="btn-util btn-save" onclick="saveTextFile()"><i class="fa-solid fa-download"></i> íŒŒì¼ ì €ì¥</button>
    </div>

    <textarea id="outputText" placeholder="ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì´ê³³ì— ê¹”ë”í•œ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤." oninput="updateCount('outputText', 'outputCount')"></textarea>
</div>

<div id="dictModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h3 style="margin-top:0; color:#444;">ğŸ“š ë‚˜ë§Œì˜ ë‹¨ì–´ì¥</h3>
        <p style="font-size:13px; color:#888; margin-bottom:15px;">ìì£¼ ë‚˜ì˜¤ëŠ” ì˜ì–´/ìˆ«ìë¥¼ ë¯¸ë¦¬ ë“±ë¡í•´ë‘ì„¸ìš”.</p>
        
        <div class="dict-form">
            <input type="text" id="newKey" placeholder="ë³€í™˜ ì „ (ì˜ˆ: Email)">
            <input type="text" id="newVal" placeholder="ë³€í™˜ í›„ (ì˜ˆ: ì´ë©”ì¼)">
            <button class="btn-add" onclick="addWord()">ë‹¨ì–´ ì¶”ê°€í•˜ê¸°</button>
        </div>
        
        <div class="dict-list-container" id="dictList"></div>
        
        <div class="backup-area">
            <button class="btn-backup" onclick="exportData()"><i class="fa-solid fa-floppy-disk"></i> ë°±ì—… ì €ì¥</button>
            <button class="btn-backup" onclick="importData()"><i class="fa-solid fa-folder-open"></i> ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <input type="file" id="fileInput" style="display: none;" onchange="loadFile(this)">
        </div>
    </div>
</div>

<script>
    // --- [ê¸°ëŠ¥ ë¡œì§ì€ 100% ë™ì¼] ---
    function updateCount(id, spanId) {
        const text = document.getElementById(id).value;
        const pureLength = text.replace(/[^a-zA-Z0-9ê°€-í£]/g, "").length;
        document.getElementById(spanId).innerText = "ìˆœìˆ˜ ê¸€ììˆ˜: " + pureLength + "ì";
    }

    function copyToClipboard() {
        const copyText = document.getElementById("outputText");
        if (copyText.value === "") { alert("ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
        copyText.select();
        document.execCommand("copy");
        
        const btn = document.querySelector('.btn-copy');
        const originalHtml = btn.innerHTML; 
        btn.innerHTML = "<i class='fa-solid fa-check'></i> ë³µì‚¬ ì™„ë£Œ!";
        btn.style.backgroundColor = "#27ae60"; 
        setTimeout(() => {
            btn.innerHTML = originalHtml;
            btn.style.backgroundColor = "#555";
        }, 1500);
    }

    function saveTextFile() {
        const text = document.getElementById("outputText").value;
        if(text === "") { alert("ì €ì¥í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
        const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
        const anchor = document.createElement("a");
        anchor.href = URL.createObjectURL(blob);
        anchor.download = "ì†ê¸°ì—°ìŠµ_ë³€í™˜ê²°ê³¼.txt";
        anchor.click();
        URL.revokeObjectURL(anchor.href);
    }

    const modal = document.getElementById("dictModal");
    function openModal() { modal.style.display = "block"; renderDictList(); document.getElementById('newKey').focus(); }
    function closeModal() { modal.style.display = "none"; }
    window.onclick = function(e) { if(e.target == modal) closeModal(); }

    const defaultDict = { "OECD": "ì˜¤ì´ì‹œë””", "Email": "ì´ë©”ì¼", "email": "ì´ë©”ì¼" };
    let myDict = JSON.parse(localStorage.getItem("stenoDict")) || defaultDict;

    function addWord() {
        const key = document.getElementById('newKey').value.trim();
        const val = document.getElementById('newVal').value.trim();
        if (!key || !val) { alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }
        myDict[key] = val; saveToStorage();
        document.getElementById('newKey').value = ""; document.getElementById('newVal').value = "";
        renderDictList(); document.getElementById('newKey').focus();
    }
    function deleteWord(key) {
        if(confirm(`'${key}' ì‚­ì œí•©ë‹ˆê¹Œ?`)) { delete myDict[key]; saveToStorage(); renderDictList(); }
    }
    function saveToStorage() { localStorage.setItem("stenoDict", JSON.stringify(myDict)); }
    function renderDictList() {
        const listDiv = document.getElementById('dictList'); listDiv.innerHTML = "";
        const keys = Object.keys(myDict).sort();
        if (keys.length === 0) { listDiv.innerHTML = "<div style='text-align:center;color:#999;padding:20px; font-size:14px;'>ë“±ë¡ëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>"; return; }
        keys.forEach(key => {
            const item = document.createElement('div'); item.className = 'dict-item';
            item.innerHTML = `<span><b>${key}</b> â†’ ${myDict[key]}</span><button class="btn-delete" onclick="deleteWord('${key}')"><i class="fa-solid fa-trash"></i></button>`;
            listDiv.appendChild(item);
        });
    }
    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(myDict));
        const a = document.createElement('a'); a.href = dataStr; a.download = "my_steno_dict.json";
        document.body.appendChild(a); a.click(); a.remove();
    }
    function importData() { document.getElementById('fileInput').click(); }
    function loadFile(input) {
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try { myDict = { ...myDict, ...JSON.parse(e.target.result) }; saveToStorage(); renderDictList(); alert("ë³µêµ¬ ì™„ë£Œ!"); }
            catch(err) { alert("íŒŒì¼ ì˜¤ë¥˜"); }
        }; reader.readAsText(file); input.value = '';
    }

    const alphabetMap = { 'A':'ì—ì´','B':'ë¹„','C':'ì”¨','D':'ë””','E':'ì´','F':'ì—í”„','G':'ì§€','H':'ì—ì´ì¹˜','I':'ì•„ì´','J':'ì œì´','K':'ì¼€ì´','L':'ì—˜','M':'ì— ','N':'ì—”','O':'ì˜¤','P':'í”¼','Q':'í','R':'ì•Œ','S':'ì—ìŠ¤','T':'í‹°','U':'ìœ ','V':'ë¸Œì´','W':'ë”ë¸”ìœ ','X':'ì—‘ìŠ¤','Y':'ì™€ì´','Z':'ì œíŠ¸'};
    const digitMap = { '0':'ì˜','1':'ì¼','2':'ì´','3':'ì‚¼','4':'ì‚¬','5':'ì˜¤','6':'ìœ¡','7':'ì¹ ','8':'íŒ”','9':'êµ¬'};

    function convertNumberToKorean(numStr) {
        const units = ['','ì‹­','ë°±','ì²œ']; const bigUnits = ['','ë§Œ','ì–µ','ì¡°','ê²½'];
        const numChar = ['ì˜','ì¼','ì´','ì‚¼','ì‚¬','ì˜¤','ìœ¡','ì¹ ','íŒ”','êµ¬'];
        let result = ''; let num = numStr.replace(/,/g,''); let length = num.length;
        for(let i=0; i<length; i++) {
            let n = parseInt(num[i]); let digitPos = length - i - 1;
            let unitIndex = digitPos % 4; let bigUnitIndex = Math.floor(digitPos/4);
            if(n > 0) {
                if(n===1 && unitIndex>0) result += units[unitIndex];
                else result += numChar[n] + units[unitIndex];
            }
            if(unitIndex===0 && bigUnitIndex>0) {
                let chunkStart = Math.max(0, i-3);
                if(parseInt(num.substring(chunkStart, i+1)) > 0) result += bigUnits[bigUnitIndex];
            }
        }
        if(result==='') return 'ì˜'; return result;
    }

    function runStage1() {
        let text = document.getElementById('inputText').value;
        text = text.replace(/\([^)]*\)/g, ""); 
        text = text.replace(/\n/g, " "); 
        text = text.replace(/[^a-zA-Z0-9ê°€-í£\s.,?%]/g, ""); 
        text = text.replace(/\s+/g, " ").trim(); 
        document.getElementById('outputText').value = text;
        updateCount('outputText', 'outputCount');
    }

    function runStage2() {
        let text = document.getElementById('outputText').value || document.getElementById('inputText').value;
        text = text.replace(/\([^)]*\)/g, "");
        text = text.replace(/6\.25/g, "ìœ¡ì´ì˜¤");
        const sortedKeys = Object.keys(myDict).sort((a,b)=>b.length-a.length);
        for(const eng of sortedKeys) {
            text = text.replace(new RegExp(`\\b${eng}\\b`,'g'), myDict[eng]);
        }
        text = text.replace(/\b[A-Z]+\b/g, (m) => /[ê°€-í£]/.test(m)?m:[...m].map(c=>alphabetMap[c]||c).join(''));
        text = text.replace(/([0-9]+)(\.[0-9]+)?/g, (m, p1, p2) => {
            let korInt = convertNumberToKorean(p1);
            let korDec = p2 ? "ì " + [...p2.substring(1)].map(c=>digitMap[c]).join('') : "";
            return korInt + korDec;
        });
        document.getElementById('outputText').value = text;
        updateCount('outputText', 'outputCount');
    }

    function resetAll() {
        document.getElementById('inputText').value = "";
        document.getElementById('outputText').value = "";
        updateCount('inputText', 'inputCount');
        updateCount('outputText', 'outputCount');
    }
</script>

</body>
</html>
