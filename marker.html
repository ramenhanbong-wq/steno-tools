<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•½ì–´ ìë™ í‘œì‹œ - ì‰½ê²Œ ê°€ì</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root {
            --bg-cream: #fdfbf7;
            --card-white: #ffffff;
            --theme-main: #a2c2ff;
            --theme-deep: #74a0ff;
            --theme-light: #f0f7ff;
            --text-main: #4a4a4a;
            --text-sub: #666666;
            --border-line: #f0ebeb;
            --highlight-bg: #fff3cd;
            --highlight-text: #e63946;
        }

        body {
            font-family: 'Gowun Dodum', 'Pretendard', sans-serif;
            margin: 0;
            background-color: var(--bg-cream);
            color: var(--text-main);
            padding-top: 90px;
            padding-bottom: 50px;
            line-height: 1.6;
        }

        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; height: 70px;
            background: rgba(255, 255, 255, 0.98); 
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; box-sizing: border-box; z-index: 1000;
            border-bottom: 1px solid #eee;
        }
        
        .logo {
            font-size: 1.15rem; color: #555; text-decoration: none;
            display: flex; align-items: center; gap: 8px; font-weight: bold;
            letter-spacing: -0.5px;
        }
        
        .nav-links { display: flex; gap: 5px; align-items: center; }
        
        .nav-item {
            text-decoration: none; color: #999; font-weight: 600; 
            padding: 8px 16px; font-size: 0.95rem;
            border-radius: 20px; display: flex; align-items: center; gap: 6px;
            transition: all 0.2s;
        }
        .nav-item:hover { color: #555; background-color: #f8f8f8; }

        .nav-item.active {
            background-color: var(--theme-light);
            color: var(--theme-deep);
            font-weight: 700;
        }

        .container {
            max-width: 900px; margin: 0 auto;
            background: var(--card-white);
            padding: 40px;
            border-radius: 25px;
            border: 2px solid var(--border-line);
            box-shadow: 0 8px 20px rgba(200, 200, 200, 0.05);
        }

        .header-area {
            text-align: center; margin-bottom: 40px;
            border-bottom: 2px dashed var(--border-line);
            padding-bottom: 20px;
        }
        .header-area h2 { margin: 0; color: var(--text-main); font-size: 1.8rem; letter-spacing: -1px; }

        .controls {
            background: #fafafa;
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--border-line);
            margin-bottom: 40px;
        }

        .input-group { margin-bottom: 20px; }
        
        label { 
            display: block; margin-bottom: 8px; font-weight: bold; 
            color: var(--text-main); font-size: 1rem;
            display: flex; align-items: center; gap: 6px;
        }
        label i { color: var(--theme-deep); }

        input[type="file"], input[type="number"] {
            width: 100%; padding: 12px;
            border: 2px solid var(--border-line); border-radius: 12px;
            background: #fff; font-family: 'Pretendard', sans-serif;
            transition: all 0.2s; box-sizing: border-box; font-size: 0.95rem;
        }
        input[type="file"]:hover, input[type="number"]:focus {
            border-color: var(--theme-main); outline: none;
        }
        
        input[type="file"]::file-selector-button {
            background: var(--theme-light); color: var(--theme-deep);
            border: none; padding: 5px 10px; border-radius: 8px;
            font-weight: bold; margin-right: 10px; cursor: pointer;
            font-family: 'Gowun Dodum', sans-serif;
        }

        .btn-group { display: flex; gap: 10px; margin-top: 30px; flex-wrap: wrap; }
        
        .btn {
            flex: 1; min-width: 140px; padding: 15px; cursor: pointer; border: none;
            border-radius: 15px; font-weight: bold; font-size: 1.05rem;
            font-family: 'Gowun Dodum', sans-serif; color: white;
            transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .btn:hover { transform: translateY(-2px); opacity: 0.9; }

        .btn-blue { background-color: var(--theme-deep); }
        .btn-gray { background-color: #999; }
        .btn-green { background-color: #67b0d1; } /* HTML ì €ì¥ìš© í¬ì¸íŠ¸ ì»¬ëŸ¬ */

        h3 {
            font-size: 1.2rem; color: var(--theme-deep);
            background: var(--theme-light); display: inline-block;
            padding: 8px 15px; border-radius: 12px;
            margin-top: 40px; margin-bottom: 20px;
        }

        table {
            width: 100%; border-collapse: separate; border-spacing: 0;
            border: 2px solid var(--border-line); border-radius: 12px; overflow: hidden;
            margin-top: 10px;
        }
        th {
            background: var(--theme-light); color: var(--text-main); font-weight: bold;
            padding: 15px; border-bottom: 1px solid var(--border-line);
        }
        td {
            padding: 12px 15px; border-bottom: 1px solid var(--border-line);
            text-align: center; color: #555;
        }
        tr:last-child td { border-bottom: none; }

        .text-content {
            line-height: 2.2; font-size: 1.05rem; text-align: justify;
            color: #333; padding: 30px; background: #fff;
            border: 2px solid var(--border-line); border-radius: 15px;
            min-height: 200px; font-family: 'Noto Sans KR', sans-serif;
            white-space: pre-wrap; word-break: break-all;
        }

        .highlight {
            color: var(--highlight-text) !important;
            background-color: var(--highlight-bg) !important;
            font-weight: 700;
            padding: 0; margin: 0; 
            border-radius: 2px;
            -webkit-box-decoration-break: clone;
            box-decoration-break: clone;
        }

        @media print {
            body { background: white; padding: 0; }
            .navbar, .controls { display: none !important; }
            .container { box-shadow: none; border: none; max-width: 100%; width: 100%; padding: 0; margin: 0; }
            h3 { background: none; color: black; padding: 0; border: none; font-size: 1.2rem; margin-top: 20px;}
            .text-content { border: none; padding: 0; }
            table, th, td { border: 1px solid #ccc; }
            .highlight {
                color: #d9534f !important;
                background-color: #fff3cd !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }

        @media (max-width: 600px) {
            .navbar { padding: 0 15px; height: 60px; }
            .nav-item span { display: none; }
            .container { padding: 20px; }
            .btn-group { flex-direction: column; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <a href="index.html" class="logo">
            <i class="fa-solid fa-cloud"></i> <span> ì™œ ì¼ì€ í•œë²ˆì— ëª°ë ¤ì˜¤ëŠ” ê±¸ê¹Œìš”? ğŸŒ¸ </span>
        </a>
        <div class="nav-links">
            <a href="index.html" class="nav-item active"><i class="fa-solid fa-house"></i><span>í™ˆ</span></a>
            <a href="marker.html" class="nav-item"><i class="fa-solid fa-highlighter"></i><span>ì•½ì–´í‘œì‹œ</span></a>
            <a href="splitter.html" class="nav-item"><i class="fa-solid fa-align-left"></i><span>ë¶„í• </span></a>
            <a href="money.html" class="nav-item"><i class="fa-solid fa-chart-line"></i><span>ë§¤ì¶œë¶„ì„</span></a>
        </div>
    </nav>

<div class="container">
    <div class="header-area">
        <h2>ğŸ“ì•½ì–´ ìë™ í‘œì‹œ</h2>
    </div>
    
    <div class="controls">
        <div class="input-group">
            <label><i class="fa-regular fa-file-excel"></i> 1. ì•½ì–´ ì—‘ì…€ íŒŒì¼ (.xlsx)</label>
            <input type="file" id="excelFile" accept=".xlsx">
        </div>
        
        <div class="input-group">
            <label><i class="fa-regular fa-file-lines"></i> 2. ì§€ë¬¸ í…ìŠ¤íŠ¸ (.txt)</label>
            <input type="file" id="textFile" accept=".txt">
        </div>
        
        <div class="input-group">
            <label><i class="fa-solid fa-chart-simple"></i> 3. í†µê³„í‘œ í‘œì‹œ ê¸°ì¤€ </label>
            <input type="number" id="minFreq" value="3" min="1" placeholder="ìˆ«ì ì…ë ¥ (ì˜ˆ: 3)">
        </div>
        
        <div class="btn-group">
            <button class="btn btn-blue" onclick="processData()">
                <i class="fa-solid fa-wand-magic-sparkles"></i> ë¶„ì„ ë° ìë£Œ ìƒì„±
            </button>
            <button class="btn btn-green" onclick="saveAsHTML()">
                <i class="fa-solid fa-download"></i> ê²°ê³¼ HTML ì €ì¥
            </button>
            <button class="btn btn-gray" onclick="window.print()">
                <i class="fa-solid fa-print"></i> PDF / ì¸ì‡„
            </button>
        </div>
    </div>

    <div id="statsSection" style="display:none;">
        <h3 id="statsTitle"><i class="fa-solid fa-list-ol"></i> ë¹ˆì¶œ ì•½ì–´ ë¦¬ìŠ¤íŠ¸</h3>
        <div id="statsTable"></div>
    </div>

    <div id="textSection" style="display:none;">
        <h3><i class="fa-solid fa-book-open"></i> ë³¸ë¬¸</h3>
        <div id="textContent" class="text-content"></div>
    </div>
</div>

<script>
    let abbreviations = [];

    async function loadExcel(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                const list = rows.map(row => row[0]).filter(val => val && val.toString().length > 1);
                list.sort((a, b) => b.toString().length - a.toString().length);
                resolve(list);
            };
            reader.readAsArrayBuffer(file);
        });
    }

    async function loadText(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.readAsText(file);
        });
    }

    async function processData() {
        const excelFileInput = document.getElementById('excelFile').files[0];
        const textFileInput = document.getElementById('textFile').files[0];
        const minFreq = parseInt(document.getElementById('minFreq').value) || 1;

        if (!excelFileInput || !textFileInput) {
            alert("âš ï¸ ì—‘ì…€ íŒŒì¼ê³¼ í…ìŠ¤íŠ¸ íŒŒì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        abbreviations = await loadExcel(excelFileInput);
        let text = await loadText(textFileInput);

        const counts = {};
        abbreviations.forEach(abbr => {
            const escapedAbbr = abbr.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(escapedAbbr, 'g');
            const matches = text.match(regex);
            if (matches) counts[abbr] = matches.length;
        });

        let statsAbbrs = Object.entries(counts)
            .filter(([_, count]) => count >= minFreq)
            .sort((a, b) => b[1] - a[1]);

        let tableHtml = `<table>
            <colgroup>
                <col style="width: 15%">
                <col style="width: 60%">
                <col style="width: 25%">
            </colgroup>
            <thead>
                <tr>
                    <th>ìˆœìœ„</th>
                    <th>ì•½ì–´</th>
                    <th>ë“±ì¥ íšŸìˆ˜</th>
                </tr>
            </thead>
            <tbody>`;
            
        statsAbbrs.forEach(([abbr, count], index) => {
            tableHtml += `<tr>
                <td><span style="background:#eee; padding:2px 8px; border-radius:10px; font-size:0.85rem;">${index + 1}</span></td>
                <td style="text-align:left; padding-left:20px; font-weight:bold; color:#333;">${abbr}</td>
                <td><span style="color:var(--theme-deep); font-weight:bold;">${count}</span>íšŒ</td>
            </tr>`;
        });
        tableHtml += "</tbody></table>";
        
        if (statsAbbrs.length === 0) {
            tableHtml = `<div style='text-align:center; padding:40px; color:#888; background:#f9f9f9; border-radius:8px;'>
                <p>ğŸ“‰ ì„¤ì •í•˜ì‹  ${minFreq}íšŒ ì´ìƒ ë“±ì¥í•œ ì•½ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>`;
        }
        
        document.getElementById('statsTitle').innerHTML = `<i class="fa-solid fa-list-ol"></i> ë¹ˆì¶œ ì•½ì–´ ë¦¬ìŠ¤íŠ¸ (${minFreq}íšŒ ì´ìƒ)`;
        document.getElementById('statsTable').innerHTML = tableHtml;

        let textAbbrs = Object.keys(counts).sort((a, b) => b.length - a.length);
        let tempText = text;
        let placeholders = [];

        textAbbrs.forEach((abbr, index) => {
            const escapedAbbr = abbr.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(escapedAbbr, 'g');
            if (tempText.match(regex)) {
                const placeholder = `@@@ABBR_${index}@@@`;
                placeholders.push({ 
                    key: placeholder, 
                    html: `<span class="highlight">${abbr}</span>` 
                });
                tempText = tempText.replace(regex, placeholder);
            }
        });

        tempText = tempText.replace(/\n/g, '<br>');
        placeholders.forEach(item => {
            tempText = tempText.split(item.key).join(item.html);
        });

        document.getElementById('textContent').innerHTML = tempText;
        
        const statsSec = document.getElementById('statsSection');
        const textSec = document.getElementById('textSection');
        statsSec.style.display = 'block';
        textSec.style.display = 'block';
        statsSec.scrollIntoView({ behavior: 'smooth' });
    }

    // ê²°ê³¼ HTML ì €ì¥ í•¨ìˆ˜
    function saveAsHTML() {
        const statsTable = document.getElementById('statsTable').innerHTML;
        const textContent = document.getElementById('textContent').innerHTML;
        const statsTitle = document.getElementById('statsTitle').innerHTML;

        if (!textContent) {
            alert("âš ï¸ ë¨¼ì € 'ë¶„ì„ ë° ìë£Œ ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•´ ì£¼ì„¸ìš”.");
            return;
        }

        const htmlTemplate = `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì•½ì–´ ë¶„ì„ ê²°ê³¼ ë¦¬í¬íŠ¸</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        ${document.querySelector('style').innerHTML}
        body { padding-top: 40px; background-color: #fdfbf7; }
        .container { border: 1px solid #ddd; box-shadow: none; margin-bottom: 50px; }
        .navbar, .controls { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-area">
            <h2>ğŸ“„ ì•½ì–´ ë¶„ì„ ê²°ê³¼ ë³´ê³ ì„œ</h2>
            <p style="color: #888;">ìƒì„± ì¼ì‹œ: ${new Date().toLocaleString()}</p>
        </div>
        
        <h3>${statsTitle}</h3>
        <div id="statsTable">${statsTable}</div>

        <h3><i class="fa-solid fa-book-open"></i> í•˜ì´ë¼ì´íŠ¸ ë³¸ë¬¸</h3>
        <div class="text-content">${textContent}</div>
    </div>
</body>
</html>`;

        const blob = new Blob([htmlTemplate], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
        a.href = url;
        a.download = `ì•½ì–´ë¶„ì„ê²°ê³¼_${timestamp}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>

</body>
</html>
